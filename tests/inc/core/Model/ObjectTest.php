<?php

namespace Runalyze\Model;

class Object_MockTester extends Object {
	public function properties() {
		return array('a', 'b', 'c');
	}
}

class ObjectWithArrays_MockTester extends Object {
	public function properties() {
		return array ('a', 'b', 'c');
	}

	public function isArray($key) {
		return ($key == 'b');
	}

	protected function canSet($key) {
		return ($key != 'c');
	}
}

/**
 * Generated by hand
 */
class ObjectTest extends \PHPUnit_Framework_TestCase {

	public function testStaticArrayMethods() {
		$TestArray = array(1, 2, 3);
		$this->assertEquals( $TestArray, Object::explode(Object::implode($TestArray)) );
	}

	public function testSimpleObject() {
		$O = new Object_MockTester(array(
			'a' => 1,
			'b' => '',
			'c' => true
		));

		$this->assertEquals(1, $O->get('a'));
		$this->assertEquals('', $O->get('b'));
		$this->assertEquals(true, $O->get('c'));

		$this->assertEquals(true, $O->has('a'));
		$this->assertEquals(false, $O->has('b'));
		$this->assertEquals(true, $O->has('c'));

		$this->assertEquals(array(
			'a' => 1,
			'b' => '',
			'c' => true
		), $O->completeData());
	}

	public function testSimpleObjectWithArray() {
		$O = new ObjectWithArrays_MockTester(array(
			'a' => 1,
			'b' => array(1, 2, 3),
			'c' => true
		));

		$this->assertEquals(array(1,2,3), $O->get('b'));
		$this->assertTrue($O->has('b'));

		$O->set('b', array());
		$this->assertFalse($O->has('b'));
	}

	public function testClearing() {
		$O = new ObjectWithArrays_MockTester(array(
			'a' => 1,
			'b' => array(1, 2, 3),
			'c' => true
		));

		$O->clear();

		$this->assertEmpty($O->get('a'));
		$this->assertEmpty($O->get('b'));
		$this->assertEmpty($O->get('c'));
	}

	public function testSimpleObjectWithArrayAsString() {
		$O = new ObjectWithArrays_MockTester(array(
			'b' => '1'.Object::ARRAY_SEPARATOR.'2'.Object::ARRAY_SEPARATOR.'3'
		));

		$this->assertEquals(array(1,2,3), $O->get('b'));
	}

	public function testDefaultValues() {
		$O = new ObjectWithArrays_MockTester();

		$this->assertEquals('', $O->get('a'));
		$this->assertEquals(array(), $O->get('b'));
		$this->assertEquals('', $O->get('c'));
	}

	/**
	 * @expectedException \InvalidArgumentException
	 */
	public function testHasException() {
		$O = new Object_MockTester();
		$O->has('foo');
	}

	/**
	 * @expectedException \InvalidArgumentException
	 */
	public function testGetException() {
		$O = new Object_MockTester();
		$O->get('foo');
	}

	/**
	 * @expectedException \InvalidArgumentException
	 */
	public function testSetException() {
		$O = new Object_MockTester();
		$O->set('foo', 'bar');
	}

	/**
	 * @expectedException \InvalidArgumentException
	 */
	public function testInvalidSetException() {
		$O = new ObjectWithArrays_MockTester();
		$O->set('c', 'd');
	}

	/**
	 * @expectedException \RuntimeException
	 */
	public function testArraySetException() {
		$O = new ObjectWithArrays_MockTester();
		$O->set('b', 'no-array');
	}

}
